<!DOCTYPE html>
<html lang="en">
<head>
    <!--适配-->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,user-scalable=no,maximum-scale=1,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="x-rim-auto-match" content="none">
    <!--适配-->
    <style type="text/css">
        html{height:100%}
        body{height:100%;margin:0px;padding:0px}
        #container{
            height: 100%;
            width: 100%
        }
        .info {
            color: pink;
            font-size: 0.5rem;
        }
        .info_img {
            width: 1rem;
            height: 1rem;
        }
        .userDefine {
            border: 0.025rem solid black;
            width: 100px;
            height: 100px;
            background: red;
        }
    </style>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=Zr0syBW4bR9VCB1KzDLGqDy55GQer4KM">
    </script>
</head>
<link rel="stylesheet" href="./common/common.css">
<body>
<div id="container"></div>
<script src="./common/jquery.js"></script>
<script src="./common/common.js"></script>
<script>
    // 创建地图实例
    var map = new BMap.Map("container");
    // 创建点坐标
    var point = new BMap.Point(114.07, 22.62);
    // 地图初始化
    map.centerAndZoom(point, 15);
    // 地图平移缩放控件
    map.addControl(new BMap.NavigationControl());

    // ===自定义标注vvv

    // 创建自定义图标对象
    function addMarker(point,index){
        var myIcon = new BMap.Icon("./images/userDefineMark.jpg", new BMap.Size(50,50),{
            // 指定定位的位置，当标注显示在地图上时，其所指向的位置距离图片左上角的位置偏移量
            anchor: new BMap.Size(25,50),
            // 设置偏移，精灵图的做法
            imageOffset: new BMap.Size(0, 0 )
        });
        // 创建标注对象并且添加到地图
        var marker = new BMap.Marker(point,{icon:myIcon});
        addActionlistener(marker,function() {
            marker.openInfoWindow(infoWindow, map.getCenter());      // 打开信息窗口
        });
        map.addOverlay(marker);
    }

    // 随机向地图添加10个标注
    var bounds = map.getBounds();
    var lngSpan = bounds.ul.lng - bounds.Ll.lng;
    var latSpan = bounds.ul.lat - bounds.Ll.lat;

    for (var i = 0; i < 10; i ++) {
        var point = new BMap.Point(bounds.Ll.lng + lngSpan * (Math.random() * 0.7 + 0.15),
            bounds.Ll.lat + latSpan * (Math.random() * 0.7 + 0.15));
        addMarker(point, i);
    }

    // ===给图标添加事件监听vvv

    function addActionlistener(marker,callback) {
        marker.addEventListener("click", function(){
            callback();
        });
    }

    // ===信息窗口vvv >>>'可以显示HTML内容'

    var opts = {
        width : 250,     // 信息窗口宽度
        height: 100,     // 信息窗口高度
        title : "Hello"  // 信息窗口标题
    }
    var infoWindow = new BMap.InfoWindow("<p class='info'>Hellow World!</p><img class='info_img' src='./images/userDefineMark.jpg'>", opts);  // 创建信息窗口对象

    // ===自定义覆盖物vvv

    /**
     * 自定义覆盖物的够造函数
     * @param center
     * @param length
     * @param color
     * @constructor
     */
    function SquareOverlay(center, length, color) {
        this._center = center;
        this._length = length;
        this._color = color;
    }
    // 继承API的BMap.Overlay
    SquareOverlay.prototype = new BMap.Overlay();

    // 重写覆盖物的初始化方法vvv >>>'我们自定义的方形覆盖物可以添加到任意图层上'
    SquareOverlay.prototype.initialize = function(map){
        // 保存map对象实例
        this._map = map;
        // 创建div元素，作为自定义覆盖物的容器
        var div = document.createElement("div");
        $(div).addClass('userDefine');
        $(div).html();
        div.style.position = "absolute";
        // 可以根据参数设置元素外观
//        div.style.width = this._length + "px";
//        div.style.height = this._length + "px";
//        div.style.background = this._color;
        // 将div添加到覆盖物容器中>>>'markerPane:文本标注层'
        map.getPanes().markerPane.appendChild(div);
        // 保存div实例
        this._div = div;
        // 需要将div元素作为方法的返回值，当调用该覆盖物的show、hide方法，或者对覆盖物进行移除时，API都将操作此元素。
        return div;
    }

    // 绘制覆盖物vvv
    SquareOverlay.prototype.draw = function(){
        // 根据地理坐标转换为像素坐标，并设置给容器 >>>'pointToOverlayPixel方法可以将地理坐标转换到覆盖物的所需要的像素坐标'
        var position = this._map.pointToOverlayPixel(this._center);
        this._div.style.left = position.x - this._length / 2  + "px";
        this._div.style.top = position.y - this._length / 2 + "px";
    }

    // 移除覆盖物 >>>'调用map.removeOverlay或者map.clearOverlays方法时，API会自动将initialize方法返回的DOM元素进行移除'
    // ...

    // 显示和隐藏覆盖物vvv >>>'元素较为复杂，也可以自己实现show和hide方法'
    SquareOverlay.prototype.show = function(){
        if (this._div){
            this._div.style.display = "";
        }
    }
    SquareOverlay.prototype.hide = function(){
        if (this._div){
            this._div.style.display = "none";
        }
    }

    // 添加自定义方法vvv
    SquareOverlay.prototype.toggle = function(){
        //TODO
    }

    // 添加自定义覆盖物
    var mySquare = new SquareOverlay(new BMap.Point(114.07, 22.62), 100, "red");
    map.addOverlay(mySquare);


</script>
</body>
</html>